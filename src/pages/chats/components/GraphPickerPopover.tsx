import { Button, Spin, Tag, Typography } from 'antd';
import React, { useMemo } from 'react';

import type { GraphDto } from '../../../autogenerated';
import { GRAPH_STATUS_META } from '../utils/chatsPageUtils';

const { Text } = Typography;

interface GraphPickerContentProps {
  graphs: GraphDto[];
  loading: boolean;
  error: string | null;
  onSelect: (graphId: string) => void;
}

export const GraphPickerContent: React.FC<GraphPickerContentProps> = React.memo(
  ({ graphs, loading, error, onSelect }) => {
    const content = useMemo(() => {
      if (loading) {
        return (
          <div style={{ padding: 12, textAlign: 'center' }}>
            <Spin size="small" />
          </div>
        );
      }
      if (error) {
        return (
          <Text type="secondary" style={{ fontSize: 12 }}>
            {error}
          </Text>
        );
      }
      if (graphs.length === 0) {
        return (
          <Text type="secondary" style={{ fontSize: 12 }}>
            No graphs available
          </Text>
        );
      }
      return (
        <div
          style={{
            maxHeight: 300,
            overflowY: 'auto',
            minWidth: 260,
            display: 'flex',
            flexDirection: 'column',
            gap: 4,
          }}>
          {graphs.map((graph) => (
            <Button
              key={graph.id}
              type="text"
              style={{
                textAlign: 'left',
                padding: '8px 12px',
                height: 'auto',
                lineHeight: 1.2,
                display: 'flex',
                flexDirection: 'column',
                alignItems: 'flex-start',
                border: '1px solid #f0f0f0',
                borderRadius: 6,
                width: '100%',
              }}
              onClick={() => onSelect(graph.id)}>
              <div
                style={{
                  display: 'flex',
                  alignItems: 'center',
                  gap: 6,
                  width: '100%',
                }}>
                <Text strong style={{ fontSize: 12, lineHeight: 1.2 }}>
                  {graph.name && graph.name.trim().length > 0
                    ? graph.name
                    : `Graph ${graph.id.slice(-6)}`}
                </Text>
                <Tag
                  color={GRAPH_STATUS_META[graph.status]?.color ?? '#d9d9d9'}
                  style={{
                    margin: 0,
                    borderRadius: 999,
                    fontSize: 9,
                    lineHeight: '16px',
                    padding: '0 6px',
                  }}>
                  {GRAPH_STATUS_META[graph.status]?.label ?? graph.status}
                </Tag>
              </div>
              <Text type="secondary" style={{ fontSize: 10, margin: 0 }}>
                v{graph.version}
                {graph.createdAt && (
                  <>
                    {' \u00b7 '}
                    {new Date(graph.createdAt).toLocaleDateString()}
                  </>
                )}
              </Text>
            </Button>
          ))}
        </div>
      );
    }, [error, graphs, loading, onSelect]);

    return content;
  },
);

GraphPickerContent.displayName = 'GraphPickerContent';
