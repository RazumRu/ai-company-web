import { ReloadOutlined } from '@ant-design/icons';
import { Button, Typography } from 'antd';
import React from 'react';

import type { ThreadMessageDto } from '../../../autogenerated';
import type { PendingMessage } from '../types/messages';
import ThreadMessagesView from './ThreadMessagesView';

const { Title } = Typography;

export interface NodeMessagesPanelProps {
  messages: ThreadMessageDto[];
  messagesLoading: boolean;
  selectedThreadId?: string;
  nodeId?: string;
  nodeTemplateKind?: string;
  onLoadMoreMessages?: () => void;
  hasMoreMessages?: boolean;
  loadingMoreMessages?: boolean;
  isNodeRunning: boolean;
  isThreadStopped?: boolean;
  currentThreadLastRunId?: string | null;
  pendingMessages?: PendingMessage[];
  newMessageMode?: 'inject_after_tool_call' | 'wait_for_completion';
  onRefreshMessages?: () => void;
}

export const NodeMessagesPanel: React.FC<NodeMessagesPanelProps> = ({
  messages,
  messagesLoading,
  selectedThreadId,
  nodeId,
  nodeTemplateKind,
  onLoadMoreMessages,
  hasMoreMessages,
  loadingMoreMessages,
  isNodeRunning,
  isThreadStopped,
  currentThreadLastRunId,
  pendingMessages,
  newMessageMode,
  onRefreshMessages,
}) => {
  return (
    <div
      style={{
        flex: 1,
        minHeight: 0,
        display: 'flex',
        flexDirection: 'column',
      }}>
      <div
        style={{
          flexShrink: 0,
          padding: '8px 0 8px 0',
          marginBottom: 0,
          display: 'flex',
          justifyContent: 'space-between',
          alignItems: 'center',
          gap: 8,
        }}>
        <Title level={5} style={{ margin: 0 }}>
          Messages
        </Title>
        <Button
          size="small"
          icon={<ReloadOutlined />}
          onClick={() => onRefreshMessages?.()}
          loading={messagesLoading}
          style={{
            border: 'none',
          }}
          disabled={!selectedThreadId || !nodeId}>
          Refresh
        </Button>
      </div>

      <div
        style={{
          flex: 1,
          minHeight: 0,
          overflow: 'hidden',
        }}>
        <ThreadMessagesView
          messages={messages}
          messagesLoading={messagesLoading}
          selectedThreadId={selectedThreadId}
          nodeId={nodeId}
          isAgentNode
          nodeTemplateKind={nodeTemplateKind}
          onLoadMoreMessages={onLoadMoreMessages}
          hasMoreMessages={hasMoreMessages}
          loadingMore={loadingMoreMessages}
          isNodeRunning={isNodeRunning}
          isThreadStopped={isThreadStopped}
          currentThreadLastRunId={currentThreadLastRunId}
          pendingMessages={pendingMessages}
          newMessageMode={newMessageMode}
        />
      </div>
    </div>
  );
};
